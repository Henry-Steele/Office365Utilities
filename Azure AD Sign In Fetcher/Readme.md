# Azure AD Sign-In Logs Fetcher

This guide explains how to set up the 'Azure AD Sign-In Logs Fetcher' application, run the software, and understand the outputs. It also includes instructions for compiling the application into an executable file and running the script version.

## Prerequisites

- Python 3.7 or higher
- An Azure AD tenant with users and recent sign in data
- Administrative access to register an application in Azure AD
- The `requests` and `pandas` libraries for Python
- Optional: `PyInstaller` for compiling the script into an executable

## Azure AD App Registration

1. **Register an Application in Azure AD**:
   - Navigate to the [Azure Portal](https://portal.azure.com/).
   - Go to `Azure Active Directory` > `App registrations` > `New registration`.
   - Enter a name for the application and register it.
   - Note down the `Application (client) ID` and `Directory (tenant) ID`.

2. **Configure API Permissions**:
   - In your registered app, go to `API permissions`.
   - Click `Add a permission` > `Microsoft Graph` > `Application permissions`.
   - Add the following permissions:
     - `AuditLog.Read.All`
     - `Directory.Read.All`
   - Grant admin consent for the added permissions.

3. **Generate a Client Secret**:
   - Go to `Certificates & secrets` > `New client secret`.
   - Add a description and expiration period, then click `Add`.
   - Note down the `Client secret` value.

## Setting Up and Running the Software, The Hard Way

### Cloning the Repository

Download or clone the repository from GitHub:

```sh
git clone https://github.com/Henry-Steele/Office365Utilities/tree/main/Azure%20AD%20Sign%20In%20Fetcher
cd [repository_name]
```

### Running the Script
1. **Create and Activate a Virtual Environment**:

```sh
python -m venv myenv
source myenv/bin/activate  # On Windows use `myenv\Scripts\activate`
```

2. **Install Required Libraries**:

```sh
pip install requests pandas
```

3. **Run the Script**:

```sh
python Get-GraphAPILastLoginTimes_v2.3_final.py
```

### Compiling into an Executable

#### Required Libriares
   - requests
   - pandas
   - tkinter (standard library)

#### Compilation Steps

1. **Install PyInstaller**:

```sh
pip install pyinstaller
```
2. **Install Libraries**:
```sh
pip install requests pandas
```

3. **Compile the Script**:

```sh
pyinstaller --onefile --windowed Get-GraphAPILastLoginTimes_v2.3_final.py
```

4. **Locate the Executable**:
   - The compiled executable will be found in the dist directory.


## Using the Application

### GUI Overview
1. **Tenant ID:** Enter your Azure AD tenant ID.
2. **Client ID:** Enter your Azure AD client ID.
3. **Client Secret:** Enter your Azure AD client secret.
4. **Output Option:** Select table, csv file, or both to choose how the data should be output.
5. **File Path:** Specify the file path if exporting to a CSV file.
6. **Show Disabled Users:** Check this box to include disabled users in the output.
7. **Run:** Click this button to fetch the data and generate the output.

### Expected Outputs
   - Table Output:
      - A table will be displayed with columns for userPrincipalName, accountEnabled, lastSignInDate, and lastSignInTime.
      - Disabled users will be shown or hidden based on the checkbox selection.
      - Users with no recent sign-ins will have a hyphen (-) in the lastSignInDate and lastSignInTime columns.

   - CSV File Output:
      - A CSV file will be generated at the specified file path.
      - The CSV file will contain the same columns as the table output.

   - Both Output:
      - Same as above options, with a combintation of new window and the file export.

## Troubleshooting

### Missing Modules:
   - If you encounter a ModuleNotFoundError, ensure the missing module is installed in your environment.
   - Edit the .spec file generated by PyInstaller to include any hidden imports.
### File Size:
   - The executable file may be large due to the inclusion of the Python interpreter and all dependencies. It is reccomended for custom compilation, to do so in a Python Virtual Enviornment, this will save space if that is a contraint.

## Conclusion
This guide provides the steps to set up the Azure AD Sign-In Logs Fetcher application, run the script, and compile it into an executable. Follow the instructions carefully to ensure all components are correctly configured and installed. For further assistance, refer to the GitHub repository Wiki or Issues.
